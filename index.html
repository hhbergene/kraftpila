<!DOCTYPE html>
<html lang="no">
<head>
  <meta charset="UTF-8" />
  <title>Tegne Krefter (JS Port)</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="stylesheet" href="web/style.css" />
</head>
<body>
  <main id="app">
    <div id="panel">
      <!-- Navigasjons- og verkt√∏yknapper plassert etter Python-layout -->
      <button class="btn-icon" id="btn-snap"        data-action="snap"        title="Snap"></button>
      <button class="btn-icon" id="btn-guidelines"  data-action="guidelines"  title="Guidelines"></button>
      <button class="btn-icon" id="btn-grid"        data-action="grid"        title="Grid"></button>

      <button class="btn-icon" id="btn-prev"        data-action="prev"        title="Forrige"></button>
      <button class="btn-wide" id="btn-help"        data-action="help"        title="Oppgave"></button>
      <button class="btn-icon" id="btn-next"        data-action="next"        title="Neste"></button>
      <button class="btn-wide" id="btn-check"       data-action="check"       title="Sjekk"></button>
      <button class="btn-wide" id="btn-reset"       data-action="reset"       title="Reset"></button>
      <button class="btn-icon" id="btn-settings"    data-action="settings"    title="Innstillinger"></button>
      <div id="user-info">
        <span id="user-display"></span>
      </div>
    </div>
    <!-- Canvas scroll container -->
    <div id="canvas-container">
      <canvas id="app-canvas"></canvas>
    </div>
    <!-- Conflict modal dialog -->
    <div id="conflict-modal" class="hidden modal">
      <div class="modal-content">
        <h3>Konflikt detektert</h3>
        <p id="conflict-message">En annen fane redigerer denne oppgaven. Oppgaven er l√•st for redigering.</p>
        <div class="modal-buttons">
          <button id="conflict-reload" class="btn-primary">üîÑ Last inn siste versjon</button>
          <button id="conflict-close" class="btn-secondary">Lukk</button>
        </div>
      </div>
    </div>
    <!-- Force panel (right side) -->
    <aside id="force-panel">
      <div class="panel-header">
        <h2>Krefter</h2>
      </div>
      <div id="force-inputs"></div>
    </aside>
    <!-- Feedback panel (left side) -->
    <div id="feedback-panel" class="hidden">
      <div id="feedback-score"></div>
      <div id="feedback-text"></div>
      <div id="feedback-nav">
        <button id="fb-prev" title="Forrige">‚óÄ</button>
        <span id="fb-count"></span>
        <button id="fb-next" title="Neste">‚ñ∂</button>
      </div>
    </div>
    <!-- Help panel (lower half) -->
    <div id="help-panel" class="hidden">
      <div class="help-header">
        <h3 id="help-title">Hjelp</h3>
        <button id="help-close" title="Lukk">‚úñ</button>
      </div>
      <div id="help-content-container" style="flex:1; overflow-y:auto; background:#ffffff;">
        <canvas id="help-canvas" style="display:block; background:#ffffff;"></canvas>
      </div>
      <div id="help-content" style="display:none;"></div>
    </div>
    <!-- Settings panel overlay (right half) -->
    <div id="settings-panel" class="hidden">
      <div class="settings-header">
        <h3>Innstillinger</h3>
        <button id="settings-close" title="Lukk">‚úñ</button>
      </div>
      <div class="settings-body">
        <label class="settings-row">
          <span>Debug-modus</span>
          <input type="checkbox" id="settings-debug" />
        </label>
        <label class="settings-row">
          <span>Brukernavn</span>
          <input type="text" id="settings-username" placeholder="Skriv navn" />
        </label>
        <label class="settings-row">
          <span>Snap aktiv</span>
          <input type="checkbox" id="settings-snap" />
        </label>
        <label class="settings-row">
          <span>Guidelines</span>
          <input type="checkbox" id="settings-guidelines" />
        </label>
        <label class="settings-row">
          <span>Vis kraft-koordinater</span>
          <input type="checkbox" id="settings-show-force-coordinates" />
        </label>
        <label class="settings-row">
          <span id="settings-comment-label">Kommentar til oppgave</span>
          <textarea id="settings-task-comment" placeholder="Skriv kommentar..." style="flex:1; padding:6px 8px; font-size:13px; border:1px solid #888; border-radius:4px; resize:vertical; min-height:60px; font-family:inherit;"></textarea>
        </label>
        <div class="settings-divider"></div>
        <div style="background:#e8f4f8; padding:12px; border-radius:4px; margin-bottom:16px; font-size:13px; line-height:1.5; color:#333;">
          <strong>Lagring:</strong> Alle kreftene og instillingene blir lagret i localStorage, men kan nullstilles av browser. Ta backup for √• sikre progresjonen eller levere fil med svar til l√¶rer.
        </div>
        <div class="settings-buttons">
          <button id="settings-download" title="Download innstillinger">Last ned backup</button>
          <button id="settings-restore" title="Last opp innstillinger">Gjenopprett fra backup</button>
          <button id="settings-upload-taskset" title="Last opp oppgavesett">Last opp oppgavesett fra l√¶rer</button>
          <input type="file" id="settings-file-input" accept=".json" style="display:none;" />
          <input type="file" id="taskset-upload-input" accept=".json" style="display:none;" />
        </div>
      </div>
    </div>
    <!-- Taskset upload modal (player mode) -->
    <div id="taskset-upload-modal" class="hidden modal">
      <div class="modal-content" style="position:relative; max-width:500px;">
        <button id="taskset-upload-close" style="position:absolute; top:10px; right:10px; background:none; border:none; font-size:24px; cursor:pointer; color:#666;">‚úï</button>
        <h2>Last opp oppgavesett</h2>
        <div style="background:#fff3cd; padding:12px; border-radius:4px; margin-bottom:16px; font-size:13px; color:#856404;">
          ‚ö†Ô∏è <strong>Advarsel:</strong> Dette nullstiller gjeldende progresjon og laster inn nytt oppgavesett.
        </div>
        <div id="taskset-upload-error" style="background:#f8d7da; color:#721c24; padding:12px; border-radius:4px; margin-bottom:16px; display:none; font-size:13px;"></div>
        
        <div id="taskset-localStorage-section" style="margin-bottom:16px;">
          <label style="display:block; margin-bottom:8px; font-weight:bold; font-size:14px;">Velg oppgavesett fra lagring:</label>
          <select id="taskset-select" style="width:100%; padding:8px; border:1px solid #ccc; border-radius:4px; font-size:13px; box-sizing:border-box;">
            <option value="">-- Ingen oppgavesett valgt --</option>
          </select>
        </div>

        <div style="margin-bottom:16px;">
          <label style="display:block; margin-bottom:8px; font-weight:bold; font-size:14px;">Last opp fra fil:</label>
          <input type="file" id="taskset-upload-file-input" accept=".json" style="display:block; padding:8px; border:1px solid #ccc; border-radius:4px; width:100%; box-sizing:border-box;" />
          <div id="taskset-file-selected" style="margin-top:8px; font-size:13px; color:#555; display:none;"></div>
        </div>
        
        <div style="display:flex; gap:8px; justify-content:flex-end;">
          <button id="taskset-upload-cancel" style="padding:8px 16px; background:#999; color:white; border:none; border-radius:4px; cursor:pointer;">Avbryt</button>
          <button id="taskset-upload-confirm" style="padding:8px 16px; background:#4CAF50; color:white; border:none; border-radius:4px; cursor:pointer;" disabled>Last opp</button>
        </div>
      </div>
    </div>
  </main>
  <!-- Midlertidig: uten ES module for √• kunne √•pne via file:// -->
  <script src="web/shared.js"></script>
  <script src="web/text_render.js"></script>
  <script src="web/geometry.js"></script>
  <script src="web/tasks.js"></script>
  <script src="web/scene_render.js"></script>
  <script src="web/debug_render.js"></script>
  <script src="web/evaluate.js"></script>
  <script src="web/forces.js"></script>
  <script src="web/forcesManager.js"></script>
  <script src="web/snapping.js"></script>
  <script src="web/ui.js"></script>
  <script src="web/main.js"></script>
</body>
</html>

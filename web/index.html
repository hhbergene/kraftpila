<!DOCTYPE html>
<html lang="no">
<head>
  <meta charset="UTF-8" />
  <title>Tegne Krefter (JS Port)</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <main id="app">
    <div id="panel">
      <!-- Navigasjons- og verktÃ¸yknapper plassert etter Python-layout -->
      <button class="btn-icon" id="btn-snap"        data-action="snap"        title="Snap"></button>
      <button class="btn-icon" id="btn-guidelines"  data-action="guidelines"  title="Guidelines"></button>
      <button class="btn-icon" id="btn-grid"        data-action="grid"        title="Grid"></button>

      <button class="btn-icon" id="btn-prev"        data-action="prev"        title="Forrige"></button>
      <button class="btn-wide" id="btn-help"        data-action="help"        title="Oppgave"></button>
      <button class="btn-icon" id="btn-next"        data-action="next"        title="Neste"></button>
      <button class="btn-wide" id="btn-check"       data-action="check"       title="Sjekk"></button>
      <button class="btn-wide" id="btn-reset"       data-action="reset"       title="Reset"></button>
      <button class="btn-icon" id="btn-settings"    data-action="settings"    title="Innstillinger"></button>
      <div id="user-info">
        <span id="user-display"></span>
      </div>
    </div>
    <!-- Canvas scroll container -->
    <div id="canvas-container">
      <canvas id="app-canvas" width="1000" height="640"></canvas>
    </div>
    <!-- Conflict modal dialog -->
    <div id="conflict-modal" class="hidden modal">
      <div class="modal-content">
        <h3>Konflikt detektert</h3>
        <p id="conflict-message">En annen fane redigerer denne oppgaven. Oppgaven er lÃ¥st for redigering.</p>
        <div class="modal-buttons">
          <button id="conflict-reload" class="btn-primary">ğŸ”„ Last inn siste versjon</button>
          <button id="conflict-close" class="btn-secondary">Lukk</button>
        </div>
      </div>
    </div>
    <!-- Force panel (right side) -->
    <aside id="force-panel">
      <div class="panel-header">
        <h2>Krefter</h2>
      </div>
      <div id="force-inputs"></div>
    </aside>
    <!-- Feedback panel (left side) -->
    <div id="feedback-panel" class="hidden">
      <div id="feedback-score"></div>
      <div id="feedback-text"></div>
      <div id="feedback-nav">
        <button id="fb-prev" title="Forrige">â—€</button>
        <span id="fb-count"></span>
        <button id="fb-next" title="Neste">â–¶</button>
      </div>
    </div>
    <!-- Help panel (lower half) -->
    <div id="help-panel" class="hidden">
      <div class="help-header">
        <h3 id="help-title">Hjelp</h3>
        <button id="help-close" title="Lukk">âœ–</button>
      </div>
      <div id="help-content"></div>
      <canvas id="help-canvas" style="display:none;"></canvas>
    </div>
    <!-- Settings panel overlay (right half) -->
    <div id="settings-panel" class="hidden">
      <div class="settings-header">
        <h3>Innstillinger</h3>
        <button id="settings-close" title="Lukk">âœ–</button>
      </div>
      <div class="settings-body">
        <label class="settings-row">
          <span>Debug-modus</span>
          <input type="checkbox" id="settings-debug" />
        </label>
        <label class="settings-row">
          <span>Brukernavn</span>
          <input type="text" id="settings-username" placeholder="Skriv navn" />
        </label>
        <label class="settings-row">
          <span>Snap aktiv</span>
          <input type="checkbox" id="settings-snap" />
        </label>
        <label class="settings-row">
          <span>Guidelines</span>
          <input type="checkbox" id="settings-guidelines" />
        </label>
        <label class="settings-row">
          <span>Vis kraft-koordinater</span>
          <input type="checkbox" id="settings-show-force-coordinates" />
        </label>
        <label class="settings-row">
          <span id="settings-comment-label">Kommentar til oppgave</span>
          <textarea id="settings-task-comment" placeholder="Skriv kommentar..." style="flex:1; padding:6px 8px; font-size:13px; border:1px solid #888; border-radius:4px; resize:vertical; min-height:60px; font-family:inherit;"></textarea>
        </label>
        <div class="settings-divider"></div>
        <div class="settings-buttons">
          <button id="settings-download" title="Download innstillinger">Last ned</button>
          <button id="settings-restore" title="Last opp innstillinger">Gjenopprett</button>
          <button id="settings-upload-taskset" title="Last opp oppgavesett">Last opp oppgavesett</button>
          <input type="file" id="settings-file-input" accept=".json" style="display:none;" />
          <input type="file" id="taskset-upload-input" accept=".json" style="display:none;" />
        </div>
      </div>
    </div>
    <!-- Taskset upload modal (player mode) -->
    <div id="taskset-upload-modal" class="hidden modal">
      <div class="modal-content" style="position:relative; max-width:500px;">
        <button id="taskset-upload-close" style="position:absolute; top:10px; right:10px; background:none; border:none; font-size:24px; cursor:pointer; color:#666;">âœ•</button>
        <h2>Last opp oppgavesett</h2>
        <div style="background:#fff3cd; padding:12px; border-radius:4px; margin-bottom:16px; font-size:13px; color:#856404;">
          âš ï¸ <strong>Advarsel:</strong> Dette nullstiller gjeldende progresjon og laster inn nytt oppgavesett.
        </div>
        <div id="taskset-upload-error" style="background:#f8d7da; color:#721c24; padding:12px; border-radius:4px; margin-bottom:16px; display:none; font-size:13px;"></div>
        <input type="file" id="taskset-upload-file-input" accept=".json" style="display:block; margin-bottom:16px; padding:8px; border:1px solid #ccc; border-radius:4px; width:100%; box-sizing:border-box;" />
        <div style="display:flex; gap:8px; justify-content:flex-end;">
          <button id="taskset-upload-cancel" style="padding:8px 16px; background:#999; color:white; border:none; border-radius:4px; cursor:pointer;">Avbryt</button>
          <button id="taskset-upload-confirm" style="padding:8px 16px; background:#4CAF50; color:white; border:none; border-radius:4px; cursor:pointer;">Last opp</button>
        </div>
      </div>
    </div>
  </main>
  <!-- Midlertidig: uten ES module for Ã¥ kunne Ã¥pne via file:// -->
  <script src="shared.js"></script>
  <script src="text_render.js"></script>
  <script src="geometry.js"></script>
  <script src="tasks.js"></script>
  <script src="scene_render.js"></script>
  <script src="debug_render.js"></script>
  <script src="evaluate.js"></script>
  <script src="forces.js"></script>
  <script src="forcesManager.js"></script>
  <script src="snapping.js"></script>
  <script src="ui.js"></script>
  <script src="main.js"></script>
</body>
</html>

<!DOCTYPE html>
<html lang="no">
<head>
  <meta charset="UTF-8" />
  <title>Kraft Editor â€“ LÃ¦rer</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="stylesheet" href="web/style.css" />
</head>
<body>
  <main id="app">
    <div id="panel">
      <!-- Navigasjons- og verktÃ¸yknapper -->
      <button class="btn-icon" id="btn-snap"        data-action="snap"        title="Snap"></button>
      <button class="btn-icon" id="btn-guidelines"  data-action="guidelines"  title="Guidelines"></button>
      <button class="btn-icon" id="btn-grid"        data-action="grid"        title="Grid"></button>

      <button class="btn-icon" id="btn-prev"        data-action="prev"        title="Forrige"></button>
      <button class="btn-wide" id="btn-help"        data-action="help"        title="Oppgave"></button>
      <button class="btn-icon" id="btn-next"        data-action="next"        title="Neste"></button>
      <button class="btn-wide" id="btn-check"       data-action="check"       title="Sjekk"></button>
      <button class="btn-icon" id="btn-settings"    data-action="settings"    title="Innstillinger"></button>
      <div id="user-info">
        <span id="user-display"></span>
      </div>
    </div>
    <!-- Canvas scroll container -->
    <div id="canvas-container">
      <canvas id="app-canvas"></canvas>
    </div>
    <!-- Editor mode buttons panel (always visible in editor) -->
    <div id="editor-buttons">
      <div class="editor-buttons-left">
        <button id="btn-save-task" title="Dupliser oppgave">ğŸ“‹</button>
        <button id="btn-new-task" title="Ny oppgave">ğŸ“„</button>
        <button id="btn-delete-task" title="Slett oppgave">ğŸ—‘ï¸</button>
        <button id="btn-export-task" title="Eksporter som JS">ğŸ“¤</button>
        <button id="btn-task-order" title="Administrer oppgaver">ğŸ“‹</button>
      </div>
      <div class="editor-buttons-right">
        <button id="btn-add-rect" title="Legg til rektangel">â–­</button>
        <button id="btn-add-ellipse" title="Legg til ellipse">â¬­</button>
        <button id="btn-add-segment" title="Legg til segment">â”€</button>
        <button id="btn-add-arrow" title="Legg til pil">â†’</button>
        <button id="btn-add-text" title="Legg til tekst">T</button>
      </div>
    </div>

    <!-- Two-panel layout: force panel (left), scene panel (right) -->
    <div id="force-scene-wrapper">
      <!-- Force panel -->
      <div id="force-panel" class="panel">
        <div id="force-header" class="panel-header">
          <h3>Krefter</h3>
        </div>
        <div id="force-inputs" class="force-inputs"></div>
      </div>
      <!-- Scene panel -->
      <div id="scene-panel" class="panel">
        <div id="scene-header" class="panel-header">
          <h3>Scene</h3>
        </div>
        <div id="scene-items" class="scene-items"></div>
      </div>
    </div>

    <!-- Feedback panel (left side) -->
    <div id="feedback-panel" class="hidden">
      <div id="feedback-score"></div>
      <div id="feedback-text"></div>
      <div id="feedback-nav">
        <button id="fb-prev" title="Forrige">â—€</button>
        <span id="fb-count"></span>
        <button id="fb-next" title="Neste">â–¶</button>
      </div>
    </div>

    <!-- Task order modal -->
    <div id="task-order-modal" class="hidden modal">
      <div class="modal-content" style="position:relative;">
        <button id="task-order-close" style="position:absolute; top:8px; right:8px; background:none; border:none; font-size:20px; cursor:pointer; padding:4px 8px;">âœ•</button>
        <h2 style="font-size:16px; margin:0 0 12px 0;">Velg og sorter oppgaver</h2>
        <div id="task-order-header" class="task-order-header">
          <button id="task-order-select-all" class="task-order-select-all" title="Velg alle">âœ…</button>
          <span class="task-order-col-id">Id</span>
          <span class="task-order-col-title">Tittel</span>
          <span class="task-order-col-category">NivÃ¥</span>
        </div>
        <div id="task-order-list"></div>
        <div id="taskset-controls" style="display:flex; gap:8px; margin-top:20px; margin-bottom:8px; align-items:center; padding-top:16px; border-top:1px solid #eee;">
          <input type="text" id="taskset-name" placeholder="Navn pÃ¥ oppgavesett" maxlength="50" style="flex:1; padding:6px 8px; border:1px solid #888; border-radius:4px; font-size:13px;">
          <button id="taskset-save-btn" style="padding:6px 12px; background:#4CAF50; color:white; border:none; border-radius:4px; cursor:pointer; font-size:13px;">Lagre</button>
          <button id="taskset-open-btn" style="padding:6px 12px; background:#FF9800; color:white; border:none; border-radius:4px; cursor:pointer; font-size:13px;">Ã…pne</button>
          <button id="taskset-export-btn" style="padding:6px 12px; background:#2196F3; color:white; border:none; border-radius:4px; cursor:pointer; font-size:13px;">Eksporter</button>
          <button id="taskset-import-btn" style="padding:6px 12px; background:#9C27B0; color:white; border:none; border-radius:4px; cursor:pointer; font-size:13px;">Importer</button>
          <input type="file" id="taskset-file-input" accept=".json" style="display:none;">
        </div>
        <div id="taskset-error" style="color:#d32f2f; font-size:11px; margin-bottom:12px; display:none;"></div>
        <div id="taskset-result" style="display:none; padding:12px; background:#f5f5f5; border:2px solid #2196F3; border-radius:4px; max-height:500px; overflow-y:auto; font-size:13px; margin-bottom:12px; order:-1;">
          <div id="taskset-report"></div>
        </div>
      </div>
    </div>

    <!-- Task set open modal -->
    <div id="taskset-open-modal" class="hidden modal">
      <div class="modal-content">
        <h2>Ã…pne oppgavesett</h2>
        <div id="taskset-list" style="max-height:300px; overflow-y:auto; margin-bottom:12px;"></div>
        <button id="taskset-open-confirm" style="padding:8px 16px; background:#4CAF50; color:white; border:none; border-radius:4px; cursor:pointer; margin-right:8px;">Ã…pne</button>
        <button id="taskset-open-cancel" style="padding:8px 16px; background:#888; color:white; border:none; border-radius:4px; cursor:pointer;">Avbryt</button>
      </div>
    </div>

    <!-- Relations editor modal -->
    <div id="relations-modal" class="hidden modal">
      <div class="modal-content">
        <h2>Kraftforhold</h2>
        <div id="relations-list"></div>
        <button id="relations-save">Lagre</button>
        <button id="relations-cancel">Avbryt</button>
      </div>
    </div>

    <!-- Settings modal -->
    <div id="settings-modal" class="hidden modal">
      <div class="modal-content">
        <h2>Innstillinger</h2>
        <label>
          <input type="checkbox" id="settings-debug" /> Debug-modus
        </label>
        <label>
          Brukernavn:
          <input type="text" id="settings-username" />
        </label>
        <label>
          <input type="checkbox" id="settings-force-coordinates" /> Vis kraft-koordinater
        </label>
        <label>
          <input type="checkbox" id="settings-show-scene-coordinates" /> Vis scene-koordinater
        </label>
        <button id="settings-save">Lagre</button>
        <button id="settings-cancel">Avbryt</button>
      </div>
    </div>

    <!-- Help panel for editing task help_lines -->
    <div id="help-panel" class="hidden">
      <div class="help-header">
        <h3 id="help-title">Hjelp</h3>
        <button id="help-close" title="Lukk">âœ–</button>
      </div>
      <div id="help-content"></div>
      <canvas id="help-canvas" style="display:none;"></canvas>
    </div>

    <!-- Settings panel overlay (right side) for editor -->
    <div id="settings-panel" class="hidden">
      <div class="settings-header">
        <h3>Innstillinger</h3>
        <button id="settings-close" title="Lukk">âœ–</button>
      </div>
      <div class="settings-body">
        <label class="settings-row">
          <span>Debug-modus</span>
          <input type="checkbox" id="settings-debug" />
        </label>
        <label class="settings-row">
          <span>Brukernavn</span>
          <input type="text" id="settings-username" placeholder="Skriv navn" />
        </label>
        <label class="settings-row">
          <span>Snap aktiv</span>
          <input type="checkbox" id="settings-snap" />
        </label>
        <label class="settings-row">
          <span>Guidelines</span>
          <input type="checkbox" id="settings-guidelines" />
        </label>
        <label class="settings-row">
          <span>Vis kraft-koordinater</span>
          <input type="checkbox" id="settings-show-force-coordinates" />
        </label>
        <label class="settings-row">
          <span>Vis scene-koordinater</span>
          <input type="checkbox" id="settings-show-scene-coordinates" />
        </label>
        <label class="settings-row">
          <span id="settings-comment-label">Kommentar til oppgave</span>
          <textarea id="settings-task-comment" placeholder="Skriv kommentar..." style="flex:1; padding:6px 8px; font-size:13px; border:1px solid #888; border-radius:4px; resize:vertical; min-height:60px; font-family:inherit;"></textarea>
        </label>
        <div class="settings-divider"></div>
        <div class="settings-buttons">
          <button id="settings-download" title="Download innstillinger">Last ned</button>
          <button id="settings-restore" title="Last opp innstillinger">Gjenopprett</button>
          <input type="file" id="settings-file-input" accept=".json" style="display:none;" />
        </div>
      </div>
    </div>

    <!-- Debug modal -->
    <div id="debug-modal" class="hidden modal">
  </main>

  <!-- Shared configuration and utilities -->
  <script src="web/shared.js"></script>
  <!-- Shared utility modules -->
  <script src="web/text_render.js"></script>
  <script src="web/geometry.js"></script>
  <script src="web/scene_render.js"></script>
  <script src="web/debug_render.js"></script>
  <script src="web/evaluate.js"></script>
  <script src="web/forces.js"></script>
  <script src="web/forcesManager.js"></script>
  <script src="web/snapping.js"></script>
  <script src="web/ui.js"></script>
  <!-- Tasks and task management -->
  <script src="web/tasks.js"></script>
  <!-- Editor entry point -->
  <script src="web/editor.js"></script>
</body>
</html>
